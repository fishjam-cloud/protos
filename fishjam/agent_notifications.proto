syntax = "proto3";

package fishjam;

import "fishjam/notifications/shared.proto";

// Defines any type of message passed from agent peer to Fishjam
message AgentRequest {
  // Request sent by agent, to authenticate to Fishjam server
  message AuthRequest {
    string token = 1;
  }

  // Request to add a track of the specified type
  message AddTrack {
    message CodecParameters {
      // The format of the input stream, defaults to pcm16
      notifications.TrackEncoding encoding = 1;
      // The sample rate of the input stream, may be omitted for opus
      uint32 sample_rate = 2;
      // The number of channels. 1 means mono, 2 means stereo
      uint32 channels = 3;
    }

    // Specification of the track to be added
    notifications.Track track = 1;
    // Parameters of the input data stream
    CodecParameters codec_params = 2;
  }

  // Removes the given track
  message RemoveTrack {
    string track_id = 1;
  }

  // Notification containing a chunk of an agent's track's data stream
  message TrackData {
    string track_id = 1;
    bytes data = 2;
  }

  // Interrupts an agent's outgoing track, preventing already queued audio from being played
  message InterruptTrack {
    string track_id = 1;
  }

  // Interrupts all of the agent's outgoing tracks, preventing already queued audio from being played
  message InterruptAllTracks {}

  oneof content {
    AuthRequest auth_request = 1;
    AddTrack add_track = 2;
    RemoveTrack remove_track = 3;
    TrackData track_data = 4;
    InterruptTrack interrupt_track = 5;
    InterruptAllTracks interrupt_all_tracks = 6;
  }
}

// Defines any type of message passed from Fishjam to agent peer
message AgentResponse {
  // Response confirming successful authentication
  message Authenticated {}

  // Notification containing a chunk of a track's data stream
  message TrackData {
    string peer_id = 1;
    notifications.Track track = 2;
    bytes data = 3;
  }

  oneof content {
    Authenticated authenticated = 1;
    TrackData track_data = 2;
  }
}
